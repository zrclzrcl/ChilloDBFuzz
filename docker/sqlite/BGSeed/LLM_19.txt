CREATE TABLE products (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    description TEXT,
    price REAL NOT NULL CHECK (price > 0),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE categories (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL UNIQUE
);

CREATE TABLE product_categories (
    product_id INTEGER NOT NULL,
    category_id INTEGER NOT NULL,
    FOREIGN KEY (product_id) REFERENCES products(id),
    FOREIGN KEY (category_id) REFERENCES categories(id),
    UNIQUE (product_id, category_id)
);

INSERT INTO categories (name) VALUES ('Electronics'), ('Books'), ('Clothing');

INSERT INTO products (name, description, price) VALUES
('Laptop', 'High-performance laptop for professionals', 1200.50),
('The Lord of the Rings', 'A classic fantasy novel', 25.00),
('T-Shirt', 'Comfortable cotton t-shirt', 15.75);

INSERT INTO product_categories (product_id, category_id) VALUES
(1, 1),
(2, 2),
(3, 3);

CREATE VIEW product_details AS
SELECT
    p.id,
    p.name,
    p.description,
    p.price,
    c.name AS category
FROM
    products p
JOIN
    product_categories pc ON p.id = pc.product_id
JOIN
    categories c ON pc.category_id = c.id;

SELECT * FROM product_details;

PRAGMA table_info(products);

CREATE TRIGGER update_product_timestamp
AFTER UPDATE ON products
BEGIN
    UPDATE products SET created_at = CURRENT_TIMESTAMP WHERE id = NEW.id;
END;

UPDATE products SET price = 1250.00 WHERE name = 'Laptop';

SELECT * FROM products WHERE price BETWEEN 10 AND 30;

DELETE FROM product_categories WHERE product_id = 3;

ALTER TABLE products ADD COLUMN discount REAL DEFAULT 0.0;

UPDATE products SET discount = 0.1 WHERE category_id = (SELECT id FROM categories WHERE name = 'Electronics');