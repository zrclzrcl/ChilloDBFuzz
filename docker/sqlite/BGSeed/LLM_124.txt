CREATE TABLE products (
    id INTEGER PRIMARY KEY,
    name TEXT NOT NULL,
    price REAL,
    description TEXT
);

CREATE TABLE categories (
    id INTEGER PRIMARY KEY,
    name TEXT NOT NULL
);

CREATE TABLE product_categories (
    product_id INTEGER,
    category_id INTEGER,
    FOREIGN KEY (product_id) REFERENCES products(id),
    FOREIGN KEY (category_id) REFERENCES categories(id)
);

INSERT INTO categories (name) VALUES ('Electronics');
INSERT INTO categories (name) VALUES ('Clothing');

INSERT INTO products (name, price, description) VALUES ('Smartphone', 800.00, 'A high-end smartphone');
INSERT INTO products (name, price, description) VALUES ('T-Shirt', 20.00, 'A comfortable cotton t-shirt');

INSERT INTO product_categories (product_id, category_id) VALUES (1, 1);
INSERT INTO product_categories (product_id, category_id) VALUES (2, 2);

CREATE VIEW product_details AS
SELECT
    p.name AS product_name,
    p.price,
    c.name AS category_name
FROM
    products p
JOIN
    product_categories pc ON p.id = pc.product_id
JOIN
    categories c ON pc.category_id = c.id;

CREATE TRIGGER update_product_price
AFTER UPDATE OF price ON products
BEGIN
    INSERT INTO products (name,price) VALUES ('Discounted '||OLD.name, NEW.price * 0.9);
END;

UPDATE products SET price = 750 WHERE id = 1;

SELECT * FROM product_details;
SELECT * FROM products;

PRAGMA integrity_check;